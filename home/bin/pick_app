#!/usr/bin/env bash

check_if_running() { 
    [ -n "$(pgrep -f "$1" )" ] 
}

# This function runs very slow for some reason (qtile)
check_if_running_in_group() { 
    check_if_running "$2" && qtile cmd-obj -o group "$1" -f info | rg -i "$2" 
}

running_apps=()

# Don't check if running for these apps because they are likely to be running
# or checking is slow
running_apps+=("alacritty")

running_apps+=("firefox")

running_apps+=("sfirefox")

if check_if_running "slack"; then
    running_apps+=("slack")
fi

if check_if_running "spotify"; then
    running_apps+=("spotify")
fi

if check_if_running "obsidian"; then
    running_apps+=("obsidian")
fi

if check_if_running "discord"; then
    running_apps+=("discord")
fi

available_apps=$(printf "%s\n" "${running_apps[@]}")

selected_app="$(echo -e "$available_apps" | dmenu -c -l 7 -bw 2)"

case "$selected_app" in
    "firefox")
        qtile cmd-obj -o group r -f toscreen
        ;;
    "sfirefox") # This contains the s group firefox
        qtile cmd-obj -o group s -f toscreen
        ;;
    "slack")
        qtile cmd-obj -o group o -f toscreen
        ;;
    "spotify")
        qtile cmd-obj -o group v -f toscreen
        ;;
    "obsidian")
        qtile cmd-obj -o group n -f toscreen
        ;;
    "discord")
        qtile cmd-obj -o group o -f toscreen
        ;;
    "alacritty")
        qtile cmd-obj -o group i -f toscreen
        ;;
esac
